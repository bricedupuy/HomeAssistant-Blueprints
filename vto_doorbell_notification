# Doorbell Notification Blueprint

A comprehensive Home Assistant blueprint for doorbell notifications with support for mobile devices, TVs, smart assistants, tablets, and ringtone playback.

## Table of Contents

- [Features](#features)
- [Requirements](#requirements)
- [Installation](#installation)
- [Initial Setup](#initial-setup)
  - [Creating Required Helpers](#creating-required-helpers)
  - [Creating Optional Helpers](#creating-optional-helpers)
  - [Setting Up Notification Groups](#setting-up-notification-groups)
- [Configuration](#configuration)
  - [Required Settings](#required-settings)
  - [Mobile Notifications](#mobile-notifications)
  - [TV Notifications](#tv-notifications)
  - [Assistant Announcements](#assistant-announcements)
  - [Tablet Display](#tablet-display)
  - [Volume Control](#volume-control)
  - [Ringtone](#ringtone)
  - [Filters & Conditions](#filters--conditions)
  - [Custom Actions](#custom-actions)
- [How It Works](#how-it-works)
- [Troubleshooting](#troubleshooting)
- [Examples](#examples)

---

## Features

| Feature | Description |
|---------|-------------|
| ğŸ“± **Mobile Notifications** | Rich notifications with camera snapshots, action buttons, and critical alerts |
| ğŸ“º **TV Notifications** | Overlay notifications on Android/Fire TV |
| ğŸ”Š **Assistant Announcements** | TTS announcements via Google Assistant, Alexa, etc. |
| ğŸ–¥ï¸ **Tablet Display** | Automatically load doorbell view on Fully Kiosk tablets |
| ğŸµ **Ringtone Playback** | Play ringtone on media players with configurable loop |
| ğŸ”‡ **Do Not Disturb** | Suppress ringtone while still sending notifications |
| ğŸšï¸ **Volume Control** | Automatic volume adjustment based on time of day |
| â¸ï¸ **Silence Button** | Temporarily disable notifications from the notification itself |
| ğŸ¯ **Smart Filters** | Filter by presence, time, entity state, and cooldown |
| âš¡ **Custom Actions** | Run any automation when doorbell rings |

---

## Requirements

### Minimum Versions

| Component | Minimum Version |
|-----------|-----------------|
| Home Assistant | 2024.1.0 |
| iOS Companion App | 2024.1 |
| Android Companion App | 2024.1 |

### Required Integrations

- **Mobile App** - For phone notifications ([Documentation](https://companion.home-assistant.io/))

### Optional Integrations

| Integration | Required For |
|-------------|--------------|
| [Fully Kiosk Browser](https://www.home-assistant.io/integrations/fully_kiosk/) | Tablet display |
| [Android TV](https://www.home-assistant.io/integrations/androidtv/) / [Fire TV](https://www.home-assistant.io/integrations/nfandroidtv/) | TV notifications |
| [Google Assistant](https://www.home-assistant.io/integrations/google_assistant/) / [Alexa Media Player](https://github.com/alandtse/alexa_media_player) | Voice announcements |
| Any camera integration | Snapshot in notifications |

---

## Installation

### Method 1: Import Button

[![Open your Home Assistant instance and show the blueprint import dialog with this blueprint pre-filled.](https://my.home-assistant.io/badges/blueprint_import.svg)](https://my.home-assistant.io/redirect/blueprint_import/?blueprint_url=YOUR_BLUEPRINT_URL_HERE)

### Method 2: Manual Installation

1. Download the blueprint YAML file
2. Place it in your `config/blueprints/automation/` directory
3. Restart Home Assistant or reload automations

---

## Initial Setup

### Creating Required Helpers

The blueprint requires an `input_boolean` to trigger doorbell events. This is typically set by your doorbell device or integration.

#### Via UI

1. Go to **Settings** â†’ **Devices & Services** â†’ **Helpers**
2. Click **+ Create Helper**
3. Select **Toggle**
4. Configure:
   - **Name:** `Doorbell Calling`
   - **Icon:** `mdi:doorbell` (optional)
5. Click **Create**

#### Via YAML

Add to your `configuration.yaml`:
```yaml
input_boolean:
  doorbell_calling:
    name: Doorbell Calling
    icon: mdi:doorbell
```

#### Connecting to Your Doorbell

You need an automation to set this input_boolean when your doorbell is pressed. Here are examples for common doorbells:

**Ring Doorbell:**
```yaml
automation:
  - alias: "Ring Doorbell Pressed"
    trigger:
      - platform: state
        entity_id: binary_sensor.front_door_ding
        to: "on"
    action:
      - service: input_boolean.turn_on
        target:
          entity_id: input_boolean.doorbell_calling
```

**Frigate Doorbell Event:**
```yaml
automation:
  - alias: "Frigate Doorbell Pressed"
    trigger:
      - platform: mqtt
        topic: frigate/events
        value_template: "{{ value_json['after']['label'] }}"
        payload: "doorbell"
    action:
      - service: input_boolean.turn_on
        target:
          entity_id: input_boolean.doorbell_calling
```

**ESPHome Doorbell:**
```yaml
automation:
  - alias: "ESPHome Doorbell Pressed"
    trigger:
      - platform: state
        entity_id: binary_sensor.doorbell_button
        to: "on"
    action:
      - service: input_boolean.turn_on
        target:
          entity_id: input_boolean.doorbell_calling
```

**Generic Zigbee/Z-Wave Button:**
```yaml
automation:
  - alias: "Zigbee Doorbell Pressed"
    trigger:
      - platform: state
        entity_id: binary_sensor.doorbell_button
        to: "on"
    action:
      - service: input_boolean.turn_on
        target:
          entity_id: input_boolean.doorbell_calling
```

### Creating Optional Helpers

#### Do Not Disturb Toggle

Create a toggle to suppress ringtone playback while still sending notifications.

**Via UI:**
1. **Settings** â†’ **Devices & Services** â†’ **Helpers** â†’ **+ Create Helper** â†’ **Toggle**
2. Configure:
   - **Name:** `Do Not Disturb`
   - **Icon:** `mdi:bell-off`

**Via YAML:**
```yaml
input_boolean:
  do_not_disturb:
    name: Do Not Disturb
    icon: mdi:bell-off
```

#### Critical Notifications Toggle

Create a toggle to enable/disable critical notifications dynamically.

**Via UI:**
1. **Settings** â†’ **Devices & Services** â†’ **Helpers** â†’ **+ Create Helper** â†’ **Toggle**
2. Configure:
   - **Name:** `Doorbell Critical Notifications`
   - **Icon:** `mdi:alert`

**Via YAML:**
```yaml
input_boolean:
  doorbell_critical:
    name: Doorbell Critical Notifications
    icon: mdi:alert
```

Then use this template in the blueprint's Critical Notification setting:
```yaml
{{ is_state('input_boolean.doorbell_critical', 'on') }}
```

### Setting Up Notification Groups

To notify multiple devices at once, create a notification group.

#### Via YAML

Add to your `configuration.yaml`:
```yaml
notify:
  - platform: group
    name: all_phones
    services:
      - service: mobile_app_phone_1
      - service: mobile_app_phone_2
      - service: mobile_app_tablet

  - platform: group
    name: all_tvs
    services:
      - service: living_room_tv
      - service: bedroom_tv

  - platform: group
    name: all_devices
    services:
      - service: mobile_app_phone_1
      - service: mobile_app_phone_2
      - service: living_room_tv
```

After adding, restart Home Assistant.

#### Finding Your Device Service Names

1. Go to **Developer Tools** â†’ **Services**
2. Search for `notify.mobile_app`
3. Your devices will appear as `notify.mobile_app_<device_name>`

---

## Configuration

### Required Settings

| Setting | Description | Example |
|---------|-------------|---------|
| **Doorbell Trigger** | The input_boolean that triggers doorbell events | `input_boolean.doorbell_calling` |

### Mobile Notifications

| Setting | Description | Default |
|---------|-------------|---------|
| **Mobile Device** | Device to receive notifications (required even if using group) | - |
| **Notification Group** | Group name to override single device | `""` |
| **Base URL** | Your HA external URL (required for images on Android) | `""` |
| **Doorbell Dashboard Path** | Path to open when tapping notification | `/lovelace/doorbell` |

#### Notification Content

| Setting | Description | Default |
|---------|-------------|---------|
| **Title** | Notification title | `Doorbell` |
| **Message** | Notification message (supports templates) | `Someone rang the doorbell...` |
| **Subtitle** | Secondary heading | `""` |
| **Color** | Android/TV notification color | `#ff9800` |
| **Icon** | Android notification icon | `mdi:doorbell` |

#### Notification Behavior

| Setting | Description | Default |
|---------|-------------|---------|
| **Critical** | Bypass DND/silent mode (template supported) | `false` |
| **Alert Once** | Only first notification plays sound | `false` |
| **Sound** | iOS notification sound | `default` |
| **Volume** | iOS sound volume (0-100) | `100` |
| **Channel** | Android notification channel | `doorbell` |
| **Sticky** | Android: keep notification after tap | `true` |
| **Android Auto** | Show on Android Auto | `false` |
| **Timeout** | Auto-dismiss after seconds (0 = never) | `120` |

#### Action Buttons

| Setting | Description | Default |
|---------|-------------|---------|
| **Tap Action** | URL when tapping notification | `/lovelace/doorbell` |
| **Button 1** | First button text | `Answer` |
| **URL 1** | First button action | `/lovelace/doorbell` |
| **Button 2** | Second button text | `Ignore` |
| **URL 2** | Second button action | `dismiss-{{ this.entity_id }}` |
| **Button 3** | Third button text | `Silence 30min` |
| **URL 3** | Third button action | `silence-{{ this.entity_id }}` |

### TV Notifications

| Setting | Description | Default |
|---------|-------------|---------|
| **Enable TV Notifications** | Turn on/off TV notifications | `false` |
| **TV Notification Service** | Notify service name | `""` |
| **Position** | Notification position | `center` |
| **Size** | Notification size | `large` |
| **Duration** | Display duration in seconds | `15` |
| **Transparency** | Background transparency | `0%` |
| **Interrupt** | Interactive notification (may pause playback) | `false` |

### Assistant Announcements

| Setting | Description | Default |
|---------|-------------|---------|
| **Enable Assistant** | Turn on/off announcements | `false` |
| **Assistant Service** | Notify service name | `""` |
| **Message** | TTS message | `Someone rang the doorbell...` |

### Tablet Display

| Setting | Description | Default |
|---------|-------------|---------|
| **Enable Tablet** | Turn on/off tablet integration | `false` |
| **Tablet Device** | Fully Kiosk device | `""` |
| **Screen Switch** | Switch to turn on screen | `""` |

### Volume Control

| Setting | Description | Default |
|---------|-------------|---------|
| **Enable Volume Control** | Turn on/off volume adjustment | `false` |
| **Media Players** | Players to adjust | `[]` |
| **Day Volume** | Volume when sun is up | `0.75` |
| **Night Volume** | Volume when sun is down | `0.60` |

### Ringtone

| Setting | Description | Default |
|---------|-------------|---------|
| **Enable Ringtone** | Turn on/off ringtone playback | `false` |
| **Media Player** | Player to use for ringtone | `""` |
| **Ringtone URL** | URL to audio file | `""` |
| **Max Plays** | Maximum loop iterations | `6` |
| **Interval** | Seconds between plays | `5` |

### Filters & Conditions

| Setting | Description | Default |
|---------|-------------|---------|
| **Do Not Disturb** | Entity to suppress ringtone | `""` |
| **Presence Filter** | Entities that must not be "home" | `[]` |
| **State Filter Enabled** | Enable state-based filtering | `false` |
| **State Filter Entity** | Entity to check | `""` |
| **State Filter States** | Required states | `[]` |
| **Time Filter** | Hours to disable notifications | `[]` |
| **Cooldown** | Minimum seconds between triggers | `15` |
| **Silence Timer** | Minutes to silence when button pressed | `30` |
| **Initial Delay** | Seconds before ringtone starts | `5` |

### Custom Actions

| Setting | Description | Default |
|---------|-------------|---------|
| **Custom Action (Auto)** | Runs automatically on doorbell | `[]` |
| **Custom Action (Manual)** | Runs when custom button pressed | `[]` |

---

## How It Works

### Flow Diagram
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Doorbell Pressedâ”‚
â”‚ (Trigger ON)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Check Filters   â”‚
â”‚ â€¢ Cooldown      â”‚
â”‚ â€¢ Time          â”‚
â”‚ â€¢ Presence      â”‚
â”‚ â€¢ State         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ Pass
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Preparation     â”‚
â”‚ â€¢ Load tablet   â”‚
â”‚ â€¢ Set volume    â”‚
â”‚ â€¢ Custom action â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Send Parallel   â”‚
â”‚ â€¢ Mobile        â”‚
â”‚ â€¢ TV            â”‚
â”‚ â€¢ Assistant     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Ringtone Loop   â”‚
â”‚ (if DND off)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Reset Trigger   â”‚
â”‚ (Turn OFF)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Notification Actions

| Button | Action | Effect |
|--------|--------|--------|
| **Answer** | Opens URI | Navigates to doorbell dashboard |
| **Ignore/Dismiss** | Dismisses notification | Clears notification |
| **Silence** | Triggers automation event | Disables automation for X minutes |

### Ringtone Behavior

1. Waits for **Initial Delay** seconds
2. Checks if **Do Not Disturb** is OFF
3. Loops while:
   - Doorbell trigger is still ON
   - Loop count < **Max Plays**
4. Plays ringtone, waits **Interval** seconds
5. Repeats until conditions fail

---

## Troubleshooting

### Notifications Not Received

1. **Check Mobile App Connection**
   - Open Home Assistant Companion App
   - Go to Settings â†’ Companion App â†’ Notifications
   - Tap "Send Test Notification"

2. **Check Notification Group**
   - Go to Developer Tools â†’ Services
   - Find your `notify.` service
   - Try sending a test notification

3. **Check Base URL**
   - Required for Android images
   - Must include `http://` or `https://`
   - Must be accessible from your phone

### Images Not Showing

1. **Android:** Ensure Base URL is set and accessible externally
2. **iOS:** Check camera entity is valid
3. **Both:** Verify camera is working in HA dashboard

### Ringtone Not Playing

1. Check media player entity is correct
2. Verify ringtone URL is accessible
3. Check Do Not Disturb is OFF
4. Verify doorbell trigger stays ON long enough

### Silence Button Not Working

1. Ensure `url_3` is set to `silence-{{ this.entity_id }}`
2. Check automation trace for the silence trigger
3. Verify automation entity_id matches

### Debug Mode

Enable **Debug Mode** in the blueprint settings to log detailed information to the logbook:

1. Go to **Settings** â†’ **Automations**
2. Edit your doorbell automation
3. Enable **Debug Mode**
4. Trigger the doorbell
5. Check **Logbook** for "Doorbell Notification" entries

---

## Examples

### Basic Setup (Mobile Only)
```yaml
automation:
  - alias: "Doorbell Notification"
    use_blueprint:
      path: doorbell_notification.yaml
      input:
        doorbell_trigger: input_boolean.doorbell_calling
        notify_device: abc123def456  # Your device ID
        base_url: "https://home.example.com"
```

### Full Setup (All Features)
```yaml
automation:
  - alias: "Doorbell Notification - Full"
    use_blueprint:
      path: doorbell_notification.yaml
      input:
        # Required
        doorbell_trigger: input_boolean.doorbell_calling
        
        # Mobile
        notify_device: abc123def456
        notify_group: notify.all_phones
        base_url: "https://home.example.com"
        doorbell_path: /lovelace/doorbell
        
        # Content
        title: "ğŸ”” Doorbell"
        message: "Someone is at the front door"
        color: "#ff9800"
        
        # Behavior
        critical: "{{ is_state('sun.sun', 'below_horizon') }}"
        sticky: true
        notification_timeout: 120
        
        # Camera
        camera_entity: camera.doorbell
        ios_live_view: camera.doorbell
        
        # TV
        tv_enabled: true
        tv_notify_service: notify.living_room_tv
        tv_duration: 20
        
        # Assistant
        assistant_enabled: true
        assistant_notify_service: notify.alexa_media
        assistant_message: "Someone is at the front door"
        
        # Tablet
        tablet_enabled: true
        tablet_device: xyz789
        tablet_screen_switch: switch.tablet_screen
        
        # Volume
        volume_enabled: true
        volume_media_players:
          - media_player.kitchen_speaker
          - media_player.living_room_speaker
        volume_day: 0.7
        volume_night: 0.5
        
        # Ringtone
        ringtone_enabled: true
        ringtone_media_player: media_player.kitchen_tablet
        ringtone_url: "http://homeassistant.local:8123/local/sounds/doorbell.mp3"
        ringtone_max_plays: 5
        ringtone_interval: 4
        
        # Filters
        do_not_disturb: input_boolean.do_not_disturb
        presence_filter:
          - person.john
          - person.jane
        cooldown: 20
        silence_timer: 30
        
        # Custom Actions
        custom_action_auto:
          - service: light.turn_on
            target:
              entity_id: light.porch
            data:
              brightness_pct: 100
```

### Night Mode with Critical Alerts
```yaml
automation:
  - alias: "Doorbell Notification - Night Critical"
    use_blueprint:
      path: doorbell_notification.yaml
      input:
        doorbell_trigger: input_boolean.doorbell_calling
        notify_device: abc123def456
        base_url: "https://home.example.com"
        
        # Critical at night
        critical: "{{'true' if now().hour >= 22 or now().hour < 7 else 'false'}}"
        
        # Louder at night
        volume: 100
        sound: default
```

### Away Mode Only
```yaml
automation:
  - alias: "Doorbell Notification - Away Only"
    use_blueprint:
      path: doorbell_notification.yaml
      input:
        doorbell_trigger: input_boolean.doorbell_calling
        notify_device: abc123def456
        base_url: "https://home.example.com"
        
        # Only notify when everyone is away
        presence_filter:
          - person.john
          - person.jane
          - person.kids
        
        # Disable ringtone (no one home to hear it)
        ringtone_enabled: false
```

---

## Support

- **Issues:** [GitHub Issues](https://github.com/YOUR_REPO/issues)
- **Discussions:** [Home Assistant Community](https://community.home-assistant.io/)

---

## License

MIT License - Feel free to use, modify, and distribute.

---

## Changelog

### v1.0.0
- Initial release
- Mobile, TV, Assistant, Tablet support
- Ringtone playback with loop
- Do Not Disturb mode
- Silence via notification button
- Full iOS and Android support
- Debug mode
